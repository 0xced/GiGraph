using System.Collections.Generic;
using System.Linq;

namespace GiGraph.Dot.Entities.Types.Strings
{
    /// <summary>
    ///     Facilitates building an escape string with custom content formatting. The output generated by the
    ///     <see cref="ToEscapeString" /> method may be assigned for example to the label attribute of an element.
    /// </summary>
    public class DotEscapeStringBuilder
    {
        protected readonly List<DotEscapeString> _items = new List<DotEscapeString>();

        /// <summary>
        ///     Creates a new instance.
        /// </summary>
        public DotEscapeStringBuilder()
        {
        }

        /// <summary>
        ///     Creates a new instance initialized with text.
        /// </summary>
        /// <param name="text">
        ///     The text to initialize the instance with.
        /// </param>
        public DotEscapeStringBuilder(string text)
        {
            Append(text);
        }

        /// <summary>
        ///     Creates a new instance initialized with escaped text (the text will not be processed further, so it should follow the
        ///     escaping rules available in the
        ///     <see href="http://www.graphviz.org/doc/info/attrs.html#k:escString">
        ///         documentation
        ///     </see>
        ///     ).
        /// </summary>
        /// <param name="escapedText">
        ///     The escaped text to initialize the instance with.
        /// </param>
        public DotEscapeStringBuilder(DotEscapedString escapedText)
        {
            AppendEscaped(escapedText);
        }

        /// <summary>
        ///     Appends the specified text to the instance.
        /// </summary>
        /// <param name="text">
        ///     The text to append to the instance.
        /// </param>
        public virtual DotEscapeStringBuilder Append(string text)
        {
            _items.Add(text);
            return this;
        }

        /// <summary>
        ///     Appends the specified escaped text to the instance (the text will not be processed further, so it should follow the escaping
        ///     rules available in the
        ///     <see href="http://www.graphviz.org/doc/info/attrs.html#k:escString">
        ///         documentation
        ///     </see>
        ///     ).
        /// </summary>
        /// <param name="escapedText">
        ///     The escaped text to append to the instance.
        /// </param>
        public virtual DotEscapeStringBuilder AppendEscaped(DotEscapedString escapedText)
        {
            _items.Add(escapedText);
            return this;
        }

        /// <summary>
        ///     Appends a line break to the instance.
        /// </summary>
        public virtual DotEscapeStringBuilder AppendLine()
        {
            _items.Add(DotEscapeString.NewLine);
            return this;
        }

        /// <summary>
        ///     Appends the specified escaped line of text to the instance.
        /// </summary>
        /// <param name="line">
        ///     The line of text to append to the instance.
        /// </param>
        public virtual DotEscapeStringBuilder AppendLine(string line)
        {
            _items.Add(line);
            _items.Add(DotEscapeString.NewLine);
            return this;
        }

        /// <summary>
        ///     Appends the specified escaped line of text to the instance (the text will not be processed further, so it should follow the
        ///     escaping rules available in the
        ///     <see href="http://www.graphviz.org/doc/info/attrs.html#k:escString">
        ///         documentation
        ///     </see>
        ///     ).
        /// </summary>
        /// <param name="escapedLine">
        ///     The escaped line of text to append to the instance.
        /// </param>
        public virtual DotEscapeStringBuilder AppendEscapedLine(DotEscapedString escapedLine)
        {
            _items.Add(escapedLine);
            _items.Add(DotEscapeString.NewLine);
            return this;
        }

        /// <summary>
        ///     <para>
        ///         Causes the last line of the previously added text to be left-justified.
        ///     </para>
        ///     <para>
        ///         Note that if further text is added to the instance after the method is called, it will appear in a new line.
        ///     </para>
        /// </summary>
        public virtual DotEscapeStringBuilder JustifyLeft()
        {
            _items.Add(DotEscapeString.JustifyLeft);
            return this;
        }

        /// <summary>
        ///     <para>
        ///         Causes the last line of the previously added text to be right-justified.
        ///     </para>
        ///     <para>
        ///         Note that if further text is added to the instance after the method is called, it will appear in a new line.
        ///     </para>
        /// </summary>
        public virtual DotEscapeStringBuilder JustifyRight()
        {
            _items.Add(DotEscapeString.JustifyRight);
            return this;
        }

        /// <summary>
        ///     Appends a placeholder that will be replaced with the label of the current object when the graph is visualized.
        /// </summary>
        public virtual DotEscapeStringBuilder AppendLabel()
        {
            _items.Add(DotEscapeString.Label);
            return this;
        }

        /// <summary>
        ///     Appends a placeholder that will be replaced with the identifier of the graph when the graph is visualized.
        /// </summary>
        public virtual DotEscapeStringBuilder AppendGraphId()
        {
            _items.Add(DotEscapeString.GraphId);
            return this;
        }

        /// <summary>
        ///     Appends a placeholder that will be replaced with the definition of the edge when the graph is visualized. Applicable to edges
        ///     only.
        /// </summary>
        public virtual DotEscapeStringBuilder AppendEdgeDefinition()
        {
            _items.Add(DotEscapeString.EdgeDefinition);
            return this;
        }

        /// <summary>
        ///     Appends a placeholder that will be replaced with the identifier of the node when the graph is visualized. Applicable to nodes
        ///     only.
        /// </summary>
        public virtual DotEscapeStringBuilder AppendNodeId()
        {
            _items.Add(DotEscapeString.NodeId);
            return this;
        }

        public override string ToString()
        {
            return string.Join(string.Empty, _items.Select(item => item.ToString()));
        }

        /// <summary>
        ///     Returns the content of the current instance as a concatenated escape string.
        /// </summary>
        public virtual DotEscapeString ToEscapeString()
        {
            return new DotConcatenatedEscapeString(_items.ToArray());
        }
    }
}